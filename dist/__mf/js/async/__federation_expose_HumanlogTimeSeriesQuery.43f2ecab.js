"use strict";(self.webpackChunkHumanlog=self.webpackChunkHumanlog||[]).push([["3855"],{47714:function(e,a,t){t.r(a),t.d(a,{HumanlogTimeSeriesQueryEditor:()=>d,DATASOURCE_KIND:()=>r,DEFAULT_DATASOURCE:()=>n,getTimeSeriesData:()=>i,HumanlogTimeSeriesQuery:()=>c});let r="HumanlogDatasource",n={kind:r};var u=t(80636),l=t(6933);let i=async(e,a)=>{if(void 0===e.query||null===e.query||""===e.query)return{series:[]};let t=(0,u.replaceVariables)(e.query,a.variableState),r=await a.datasourceStore.getDatasourceClient(e.datasource??n),{start:i,end:s}=a.timeRange;return{series:function(e){var a,t;if(console.log("buildTimeSeries called with response:",e),!(null==e||null==(t=e.data)||null==(a=t.data)?void 0:a.shape.case)||"freeForm"!==e.data.data.shape.case)return[];let{type:r,rows:n}=e.data.data.shape.value;if(!(null==r?void 0:r.columns)||0===n.length)return[];let u=r.columns.findIndex(e=>{var a,t;return(null==(t=e.type)||null==(a=t.type)?void 0:a.case)==="scalar"&&e.type.type.value===l.wx.ts}),i=r.columns.findIndex(e=>{var a,t;return(null==(t=e.type)||null==(a=t.type)?void 0:a.case)==="scalar"&&(e.type.type.value===l.wx.f64||e.type.type.value===l.wx.i64)});if(-1===i&&(i=r.columns.findIndex(e=>{var a,t;return(null==(t=e.type)||null==(a=t.type)?void 0:a.case)==="scalar"&&e.type.type.value===l.wx.dur})),-1===u||-1===i)return[];let s=[];for(let e of n){let a,t,r=e.items[u],n=e.items[i];if(r&&n){if("ts"!==r.kind.case)continue;if(a=r.kind.value.toDate().getTime(),"f64"===n.kind.case)t=n.kind.value;else if("i64"===n.kind.case)t=Number(n.kind.value);else if("dur"===n.kind.case){let e=n.kind.value;t=1e3*Number(e.seconds||0)+(e.nanos||0)/1e6}else t=null;s.push([a,t])}}s.sort((e,a)=>e[0]-a[0]);let o=[{name:"humanlog-time-series",values:s}];return console.log("Returning result:",o),o}(await r.query({start:i.getTime().toString(),end:s.getTime().toString(),query:t})),timeRange:{start:i,end:s},stepMs:3e4,metadata:{executedQueryString:t}}};var s=t(85893),o=t(2388);function d(e){let{onChange:a,value:t}=e,{datasource:l}=t,[i,d]=(0,o.useState)(t.query);return(0,o.useEffect)(()=>{d(t.query)},[t.query]),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{children:"HumanlogTimeSeriesQuery Datasource"}),(0,s.jsx)(u.DatasourceSelect,{datasourcePluginKind:r,value:l??n,onChange:e=>{if(!(0,u.isVariableDatasource)(e)&&e.kind===r)return void a({...t,datasource:e});throw Error("Got unexpected non HumanlogTimeSeriesQuery datasource selection")},label:"HumanlogTimeSeriesQuery Datasource",notched:!0}),(0,s.jsx)("input",{onBlur:e=>{let r=e.target.value;r!==t.query&&a({...t,query:r})},onChange:e=>d(e.target.value),placeholder:"query",value:i})]})}let c={getTimeSeriesData:i,OptionsEditorComponent:d,createInitialOptions:()=>({query:""}),dependsOn:e=>({variables:[...new Set([...(0,u.parseVariables)(e.query)])]})}}}]);