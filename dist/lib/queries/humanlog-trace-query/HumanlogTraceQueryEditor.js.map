{"version":3,"sources":["../../../../src/queries/humanlog-trace-query/HumanlogTraceQueryEditor.tsx"],"sourcesContent":["import {\n  DatasourceSelect,\n  DatasourceSelectProps,\n  isVariableDatasource,\n  OptionsEditorProps,\n} from \"@perses-dev/plugin-system\";\nimport { ReactElement, useEffect, useState } from \"react\";\nimport { HumanlogTraceQuerySpec } from \"./humanlog-trace-query-types\";\nimport { DATASOURCE_KIND, DEFAULT_DATASOURCE } from \"../constants\";\n\ntype HumanlogTraceQueryEditorProps = OptionsEditorProps<HumanlogTraceQuerySpec>;\n\nexport function HumanlogTraceQueryEditor(\n  props: HumanlogTraceQueryEditorProps,\n): ReactElement {\n  const { onChange, value } = props;\n  const { datasource } = value;\n  const selectedDatasource = datasource ?? DEFAULT_DATASOURCE;\n  const [localQuery, setLocalQuery] = useState(value.query);\n\n  const handleDatasourceChange: DatasourceSelectProps[\"onChange\"] = (\n    newDatasourceSelection,\n  ) => {\n    if (\n      !isVariableDatasource(newDatasourceSelection) &&\n      newDatasourceSelection.kind === DATASOURCE_KIND\n    ) {\n      onChange({ ...value, datasource: newDatasourceSelection });\n      return;\n    }\n\n    throw new Error(\n      \"Got unexpected non HumanlogTraceQuery datasource selection\",\n    );\n  };\n\n  const handleQueryBlur = (event: React.FocusEvent<HTMLInputElement>) => {\n    const newQuery = event.target.value;\n    if (newQuery !== value.query) {\n      onChange({ ...value, query: newQuery });\n    }\n  };\n\n  useEffect(() => {\n    setLocalQuery(value.query);\n  }, [value.query]);\n\n  return (\n    <div>\n      <label>HumanlogTraceQuery Datasource</label>\n      <DatasourceSelect\n        datasourcePluginKind={DATASOURCE_KIND}\n        value={selectedDatasource}\n        onChange={handleDatasourceChange}\n        label=\"HumanlogTraceQuery Datasource\"\n        notched\n      />\n      <input\n        onBlur={handleQueryBlur}\n        onChange={(e) => setLocalQuery(e.target.value)}\n        placeholder=\"query\"\n        value={localQuery}\n      />\n    </div>\n  );\n}\n"],"names":["DatasourceSelect","isVariableDatasource","useEffect","useState","DATASOURCE_KIND","DEFAULT_DATASOURCE","HumanlogTraceQueryEditor","props","onChange","value","datasource","selectedDatasource","localQuery","setLocalQuery","query","handleDatasourceChange","newDatasourceSelection","kind","Error","handleQueryBlur","event","newQuery","target","div","label","datasourcePluginKind","notched","input","onBlur","e","placeholder"],"mappings":";AAAA,SACEA,gBAAgB,EAEhBC,oBAAoB,QAEf,4BAA4B;AACnC,SAAuBC,SAAS,EAAEC,QAAQ,QAAQ,QAAQ;AAE1D,SAASC,eAAe,EAAEC,kBAAkB,QAAQ,eAAe;AAInE,OAAO,SAASC,yBACdC,KAAoC;IAEpC,MAAM,EAAEC,QAAQ,EAAEC,KAAK,EAAE,GAAGF;IAC5B,MAAM,EAAEG,UAAU,EAAE,GAAGD;IACvB,MAAME,qBAAqBD,cAAcL;IACzC,MAAM,CAACO,YAAYC,cAAc,GAAGV,SAASM,MAAMK,KAAK;IAExD,MAAMC,yBAA4D,CAChEC;QAEA,IACE,CAACf,qBAAqBe,2BACtBA,uBAAuBC,IAAI,KAAKb,iBAChC;YACAI,SAAS;gBAAE,GAAGC,KAAK;gBAAEC,YAAYM;YAAuB;YACxD;QACF;QAEA,MAAM,IAAIE,MACR;IAEJ;IAEA,MAAMC,kBAAkB,CAACC;QACvB,MAAMC,WAAWD,MAAME,MAAM,CAACb,KAAK;QACnC,IAAIY,aAAaZ,MAAMK,KAAK,EAAE;YAC5BN,SAAS;gBAAE,GAAGC,KAAK;gBAAEK,OAAOO;YAAS;QACvC;IACF;IAEAnB,UAAU;QACRW,cAAcJ,MAAMK,KAAK;IAC3B,GAAG;QAACL,MAAMK,KAAK;KAAC;IAEhB,qBACE,MAACS;;0BACC,KAACC;0BAAM;;0BACP,KAACxB;gBACCyB,sBAAsBrB;gBACtBK,OAAOE;gBACPH,UAAUO;gBACVS,OAAM;gBACNE,OAAO;;0BAET,KAACC;gBACCC,QAAQT;gBACRX,UAAU,CAACqB,IAAMhB,cAAcgB,EAAEP,MAAM,CAACb,KAAK;gBAC7CqB,aAAY;gBACZrB,OAAOG;;;;AAIf"}